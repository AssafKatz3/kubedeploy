---
helmDefaults:
  atomic: true
  wait: true
  createNamespace: true

environments:
  default:
    values:
      - common-values.yaml
---
templates:
  default: &default
    namespace: statefulset
    chart: ../{{ requiredEnv "CHART_NAME" }}
    installed: true
    valuesTemplate:
      - fullnameOverride: '{{`{{ .Release.Name }}`}}'
      - deploymentMode: Statefulset
      - image:
          repository: nginx
          tag: latest

releases:
  # simple statefulset testing
  - name: {{requiredEnv "RELEASE_NAME"}}
    labels:
      test: simple
    <<: *default

  # statefulset with init and additional containers, 2 replicas with soft antiaffinity
  # and min ready seconds set to 30
  - name: {{requiredEnv "RELEASE_NAME"}}-multi-container
    labels:
      test: multi-container
    <<: *default
    values:
      - replicaCount: 2
      - podAntiAffinity: "soft"
      - minReadySeconds: 5
      - persistency:
          enabled: true
          capacity:
            storage: {{ .Values.persistency.size }}
      - additionalContainers:
          enabled: true
      - initContainers:
          enabled: true

  # statefulset with configmaps and additional containers
  - name: {{requiredEnv "RELEASE_NAME"}}-configmaps
    labels:
      test: configmaps
    <<: *default
    values:
      - persistency:
          enabled: true
          capacity:
            storage: {{ .Values.persistency.size }}
      - additionalContainers:
          enabled: true
      - configMaps:
        - name: kubedeploy-configmap
          mount: true
          mountPath: /data/confmap
          data:
            kubedeploy: |+
              configmap values
        - name: kubedeploy2-configmap
          data:
            config: |+
              config2
