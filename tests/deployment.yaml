---
helmDefaults:
  atomic: true
  wait: true
  createNamespace: true

environments:
  default:
    values:
      - common-values.yaml

releases:
  # simple deployment testing
  - name: {{requiredEnv "RELEASE_NAME"}}
    namespace: deployment
    chart: ../{{ requiredEnv "CHART_NAME" }}
    installed: true
    values:
      - deploymentMode: Deployment
      - image:
          repository: nginx
          tag: latest

  # deployment with replicas
  - name: {{requiredEnv "RELEASE_NAME"}}-replicas
    namespace: deployment
    chart: ../{{ requiredEnv "CHART_NAME" }}
    installed: true
    values:
      - replicaCount: 2
      - deploymentMode: Deployment
      - image:
          repository: nginx
          tag: latest
      - topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: zone
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app.kubernetes.io/instance: testing-replicas


  # deployment with init and additional containers
  - name: {{requiredEnv "RELEASE_NAME"}}-multi-container
    namespace: deployment
    chart: ../{{ requiredEnv "CHART_NAME" }}
    installed: true
    values:
      - deploymentMode: Deployment
      - image:
          repository: nginx
          tag: latest
      - additionalContainers:
          enabled: true
      - initContainers:
          enabled: true

  # deployment with configmaps and additional containers
  - name: {{requiredEnv "RELEASE_NAME"}}-configmaps
    namespace: deployment
    chart: ../{{ requiredEnv "CHART_NAME" }}
    installed: true
    values:
      - deploymentMode: Deployment
      - image:
          repository: nginx
          tag: latest
      - additionalContainers:
          enabled: true
      - configMaps:
        - name: kubedeploy-configmap
          mount: true
          mountPath: /data/confmap
          data:
            kubedeploy: |+
              configmap values
        - name: kubedeploy2-configmap
          data:
            config: |+
              config2
